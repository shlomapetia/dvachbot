# japanese_translator.py
import random
import re

# Расширенные словари для транслитерации
HIRAGANA_MAP = {
    'а': 'あ', 'и': 'い', 'у': 'う', 'э': 'え', 'о': 'お',
    'ка': 'か', 'ки': 'き', 'ку': 'く', 'кэ': 'け', 'ко': 'こ',
    'кя': 'きゃ', 'кю': 'きゅ', 'кё': 'きょ',
    'га': 'が', 'ги': 'ぎ', 'гу': 'ぐ', 'гэ': 'げ', 'го': 'ご',
    'гя': 'ぎゃ', 'гю': 'ぎゅ', 'гё': 'ぎょ',
    'са': 'さ', 'си': 'し', 'су': 'す', 'сэ': 'せ', 'со': 'そ',
    'ся': 'しゃ', 'сю': 'しゅ', 'сё': 'しょ',
    'за': 'ざ', 'зи': 'じ', 'зу': 'ず', 'зэ': 'ぜ', 'зо': 'ぞ',
    'зя': 'じゃ', 'зю': 'じゅ', 'зё': 'じょ',
    'та': 'た', 'ти': 'ち', 'тэ': 'て', 'то': 'と', 'цу': 'つ',
    'тя': 'ちゃ', 'тю': 'ちゅ', 'тё': 'ちょ',
    'да': 'だ', 'ди': 'ぢ', 'дэ': 'で', 'до': 'ど', 'дзу': 'づ',
    'дя': 'ぢゃ', 'дю': 'ぢゅ', 'дё': 'ぢょ',
    'на': 'な', 'ни': 'に', 'ну': 'ぬ', 'нэ': 'ね', 'но': 'の',
    'ня': 'にゃ', 'ню': 'にゅ', 'нё': 'にょ',
    'ха': 'は', 'хи': 'ひ', 'ху': 'ふ', 'хэ': 'へ', 'хо': 'ほ',
    'хя': 'ひゃ', 'хю': 'ひゅ', 'хё': 'ひょ',
    'ба': 'ば', 'би': 'び', 'бу': 'ぶ', 'бэ': 'べ', 'бо': 'ぼ',
    'бя': 'びゃ', 'бю': 'びゅ', 'бё': 'びょ',
    'па': 'ぱ', 'пи': 'ぴ', 'пу': 'ぷ', 'пэ': 'ぺ', 'по': 'ぽ',
    'пя': 'ぴゃ', 'пю': 'ぴゅ', 'пё': 'ぴょ',
    'ма': 'ま', 'ми': 'み', 'му': 'む', 'мэ': 'め', 'мо': 'も',
    'мя': 'みゃ', 'мю': 'みゅ', 'мё': 'みょ',
    'ра': 'ら', 'ри': 'り', 'ру': 'る', 'рэ': 'れ', 'ро': 'ろ',
    'ря': 'りゃ', 'рю': 'りゅ', 'рё': 'りょ',
    'ва': 'わ', 'ви': 'うぃ', 'вэ': 'うぇ', 'во': 'を',
    'фа': 'ふぁ', 'фи': 'ふぃ', 'фу': 'ふ', 'фэ': 'ふぇ', 'фо': 'ふぉ',
    'йа': 'や', 'йу': 'ゆ', 'йо': 'よ',
    'ла': 'ら', 'ли': 'り', 'лэ': 'れ', 'лу': 'る', 'ло': 'ろ', 'ля': 'りゃ', 'лю': 'りゅ', 'лё': 'りょ',
    'ща': 'しゃ', 'щу': 'しゅ', 'що': 'しょ', 'ще': 'しぇ',
    'ча': 'ちゃ', 'чу': 'ちゅ', 'чо': 'ちょ', 'че': 'ちぇ',
    'ц': 'つ', 'ца': 'つぁ', 'цо': 'つぉ', 'це': 'つぇ', 'цы': 'つぃ', 'цю': 'つゅ',
    'ж': 'じ', 'жа': 'じゃ', 'же': 'じぇ', 'жи': 'じ', 'жо': 'じょ', 'жу': 'じゅ',
    'ш': 'し', 'ша': 'しゃ', 'ше': 'しぇ', 'ши': 'し', 'шо': 'しょ', 'шу': 'しゅ',
    'й': 'い', 'ь': '', 'ъ': '', 'ы': 'い', 'йи': 'い', 'йы': 'い',
    'в': 'ゔ', 'ва': 'ゔぁ', 'ве': 'ゔぇ', 'ви': 'ゔぃ', 'во': 'ゔぉ', 'ву': 'ゔ',
    'дж': 'ぢ', 'дз': 'づ', 'джа': 'ぢゃ', 'дже': 'ぢぇ', 'джо': 'ぢょ', 'джу': 'ぢゅ',
    'кс': 'くす', 'гз': 'ぐず', 'кв': 'くゔ', 'тс': 'つ', 'тьс': 'つ', 
    'ль': 'り', 'нь': 'ん', 'ль': 'り', 'рр': 'っら', 'сс': 'っさ', 'тт': 'った', 'пп': 'っぱ',
    'йе': 'いぇ', 'йэ': 'いぇ', 'йё': 'いよ', 'йя': 'いや',
}

KATAKANA_MAP = {
    'а': 'ア', 'и': 'イ', 'у': 'ウ', 'э': 'エ', 'о': 'オ',
    'ка': 'カ', 'ки': 'キ', 'ку': 'ク', 'кэ': 'ケ', 'ко': 'コ',
    'кя': 'キャ', 'кю': 'キュ', 'кё': 'キョ',
    'га': 'ガ', 'ги': 'ギ', 'гу': 'グ', 'гэ': 'ゲ', 'го': 'ゴ',
    'гя': 'ギャ', 'гю': 'ギュ', 'гё': 'ギョ',
    'са': 'サ', 'си': 'シ', 'су': 'ス', 'сэ': 'セ', 'со': 'ソ',
    'ся': 'シャ', 'сю': 'シュ', 'сё': 'ショ',
    'за': 'ザ', 'зи': 'ジ', 'зу': 'ズ', 'зэ': 'ゼ', 'зо': 'ゾ',
    'зя': 'ジャ', 'зю': 'ジュ', 'зё': 'ジョ',
    'та': 'タ', 'ти': 'チ', 'тэ': 'テ', 'то': 'ト', 'цу': 'ツ',
    'тя': 'チャ', 'тю': 'チュ', 'тё': 'チョ',
    'да': 'ダ', 'ди': 'ヂ', 'дэ': 'デ', 'до': 'ド', 'дзу': 'ヅ',
    'дя': 'ヂャ', 'дю': 'ヂュ', 'дё': 'ヂョ',
    'на': 'ナ', 'ни': 'ニ', 'ну': 'ヌ', 'нэ': 'ネ', 'но': 'ノ',
    'ня': 'ニャ', 'ню': 'ニュ', 'нё': 'ニョ',
    'ха': 'ハ', 'хи': 'ヒ', 'ху': 'フ', 'хэ': 'ヘ', 'хо': 'ホ',
    'хя': 'ヒャ', 'хю': 'ヒュ', 'хё': 'ヒョ',
    'ба': 'バ', 'би': 'ビ', 'бу': 'ブ', 'бэ': 'ベ', 'бо': 'ボ',
    'бя': 'ビャ', 'бю': 'ビュ', 'бё': 'ビョ',
    'па': 'パ', 'пи': 'ピ', 'пу': 'プ', 'пэ': 'ペ', 'по': 'ポ',
    'пя': 'ピャ', 'пю': 'ピュ', 'пё': 'ピョ',
    'ма': 'マ', 'ми': 'ミ', 'му': 'ム', 'мэ': 'メ', 'мо': 'モ',
    'мя': 'ミャ', 'мю': 'ミュ', 'мё': 'ミョ',
    'ра': 'ラ', 'ри': 'リ', 'ру': 'ル', 'рэ': 'レ', 'ро': 'ロ',
    'ря': 'リャ', 'рю': 'リュ', 'рё': 'リョ',
    'ва': 'ワ', 'ви': 'ウィ', 'вэ': 'ウェ', 'во': 'ヲ',
    'фа': 'ファ', 'фи': 'フィ', 'фу': 'フ', 'фэ': 'フェ', 'фо': 'フォ',
    'йа': 'ヤ', 'йу': 'ユ', 'йо': 'ヨ',
    'ла': 'ラ', 'ли': 'リ', 'лэ': 'レ', 'лу': 'ル', 'ло': 'ロ', 'ля': 'リャ', 'лю': 'リュ', 'лё': 'リョ',
    'ща': 'シャ', 'щу': 'シュ', 'що': 'ショ', 'ще': 'シェ',
    'ча': 'チャ', 'чу': 'チュ', 'чо': 'チョ', 'че': 'チェ',
    'ц': 'ツ', 'ца': 'ツァ', 'цо': 'ツォ', 'це': 'ツェ', 'цы': 'ツィ', 'цю': 'ツュ',
    'ж': 'ジ', 'жа': 'ジャ', 'же': 'ジェ', 'жи': 'ジ', 'жо': 'ジョ', 'жу': 'ジュ',
    'ш': 'シ', 'ша': 'シャ', 'ше': 'シェ', 'ши': 'シ', 'шо': 'ショ', 'шу': 'シュ',
    'й': 'イ', 'ь': '', 'ъ': '', 'ы': 'イ', 'йи': 'イ', 'йы': 'イ',
    'в': 'ヴ', 'ва': 'ヴァ', 'ве': 'ヴェ', 'ви': 'ヴィ', 'во': 'ヴォ', 'ву': 'ヴ',
    'дж': 'ヂ', 'дз': 'ヅ', 'джа': 'ヂャ', 'дже': 'ヂェ', 'джо': 'ヂョ', 'джу': 'ヂュ',
    'кс': 'クス', 'гз': 'グズ', 'кв': 'クヴ', 'тс': 'ツ', 'тьс': 'ツ', 
    'ль': 'リ', 'нь': 'ン', 'ль': 'リ', 'рр': 'ッラ', 'сс': 'ッサ', 'тт': 'ッタ', 'пп': 'ッパ',
    'йе': 'イェ', 'йэ': 'イェ', 'йё': 'イヨ', 'йя': 'イヤ',
}

# Японские числа (улучшенная конвертация)
NUMERALS = {
    0: '零', 1: '一', 2: '二', 3: '三', 4: '四',
    5: '五', 6: '六', 7: '七', 8: '八', 9: '九',
    10: '十', 100: '百', 1000: '千', 10000: '万',
    100000000: '億'
}

# Расширенные списки японских частиц
PARTICLES = [
    'ね', 'よ', 'か', 'わ', 'の', 'な', 'ぞ', 'ぜ', 'が', 'に', 'で', 'と', 'も', 'や',
    'さ', 'かしら', 'とも', 'っけ', 'こそ', 'まで', 'ばかり', 'だけ', 'ほど', 'くらい',
    'なり', 'やら', 'だの', 'とか', 'って', 'てば', 'たら', 'れば', 'のに', 'ので',
    'から', 'し', 'ながら', 'たり', 'つつ', 'とも', 'ども', 'もの', 'こと', 'ところ',
    'として', 'において', 'について', 'によって', 'としては', 'にとって', 'ばかりか',
    'のみならず', 'どころか', 'ばかりでなく', 'だけでなく', 'けれども', 'がてら', 'かたがた',
    'ついでに', 'とともに', 'にしたがって', 'にともなって', 'にもかかわらず', 'のかわりに',
    'のほかに', 'のうちに', 'のとおりに', 'のだ', 'のです', 'んでした', 'んです'
]

# Расширенные списки междометий
INTERJECTIONS = [
    'ああ', 'あら', 'まあ', 'ええ', 'おお', 'やれ', 'やっほ', 'わあ', 'うわ', 'あっ',
    'ううん', 'うん', 'えへへ', 'おや', 'おっと', 'おおきに', 'ありがと', 'すみません',
    'ごめん', 'ごめんなさい', 'わーい', 'やったー', 'しまった', 'ちくしょう', 'くそ',
    'おいおい', 'おやおや', 'さてさて', 'よしよし', 'あれれ', 'あらら', 'うふふ', 'くくく',
    'にやり', 'げっ', 'うえっ', 'おっとっと', 'どっこい', 'おっほっほ', 'あはは', 'いやいや',
    'いやはや', 'はあ', 'へえ', 'ほう', 'ふうん', 'ふむ', 'むむ', 'うむ', 'うーん', 'んん',
    'あーあ', 'はぁ', 'はああ', 'ひいい', 'ひええ', 'うひょー', 'わくわく', 'どきどき',
    'わさわさ', 'そわそわ', 'じーん', 'がーん', 'びっくり', 'おっと', 'どん', 'ばん', 'ぱちぱち',
    'ぽよよーん', 'にょろにょろ', 'ぬるぬる', 'つるつる', 'ぷにぷに', 'もふもふ', 'ごしごし',
    'ごろごろ', 'すやすや', 'すいすい', 'すたこら', 'てけてけ', 'にゃお', 'わん', 'こんにちは',
    'おはよう', 'こんばんは', 'おやすみ', 'いただきます', 'ごちそうさま', 'ただいま', 'おかえり',
    'いってきます', 'いってらっしゃい', 'おめでとう', 'おだいじに'
]

# Расширенные списки ня-междометий
NYA_INTERJECTIONS = [
    'にゃあ', 'にゃん', 'にゃーん', 'にゃお', 'ぎゃあ', 'きゃあ', 'みゃあ', 'みゃお',
    'にゃっ', 'にゃんにゃん', 'にゃー', 'にゃも', 'にゃろ', 'にゃはは', 'にゃふ', 'にゃんこ',
    'にゃんぱすー', 'にゃーんご', 'にゃんち', 'にゃんて', 'にゃんたん', 'にゃんべ', 'にゃんぼ',
    'にゃんにゃんお', 'にゃんちゅ', 'にゃんぴ', 'にゃんぷ', 'にゃんみ', 'にゃんも', 'にゃんり',
    'にゃんわ', 'にゃんが', 'にゃんざ', 'にゃんだ', 'にゃんば', 'にゃんぱ', 'にゃんじ',
    'にゃんび', 'にゃんぎ', 'にゃんぷ', 'みゃー', 'みゃう', 'みゃく', 'みゃこ', 'みゃそ',
    'ぎゃー', 'ぎゃく', 'ぎゃぐ', 'ぎゃす', 'ぎゃぜ', 'ぎゃど', 'ぎゃば', 'ぎゃぱ', 'きゃー',
    'きゃき', 'きゃく', 'きゃち', 'きゃつ', 'きゃん', 'きゃんきゃん', 'にゃんき', 'にゃんきー',
    'にゃんきゃ', 'にゃんきゅ', 'にゃんきょ', 'みゃん', 'ぎゃん', 'きゃん', 'にゃんにゃんにゃん'
]

# Расширенные списки начальных фраз
START_PHRASES = [
    '実は', 'つまり', '要するに', '例えば', '確かに', '一般的に', '基本的に', '正直言って',
    '実際のところ', '私の考えでは', '言ってみれば', 'あのね', 'えっと', 'そういえば', 
    '結論から言うと', '突然ですが', 'ご存知ですか', '実を言うと', '驚いたことに', 
    '信じられないかもしれないが', '率直に言って', '個人的には', '皆さんご存知のように',
    '昔から', '最近気づいたんだけど', '改めて言うまでもなく', '周知の事実ですが',
    '意外かもしれませんが', '面白いことに', '悲しいかな', '残念ながら', '幸いなことに',
    '残念なことに', '当然のことながら', '驚くべきことに', '予想通り', '予想外にも',
    '興味深いことに', '厳密に言えば', '大げさに言えば', '簡単に言うと', '一言で言うと',
    '詳しく説明すると', '結論を先に言えば', '本題に入りますが', '前置きが長くなりましたが',
    '突然で恐縮ですが', '余談ですが', '話は変わりますが', '蛇足ながら', 'ついでに言えば',
    '言い忘れていましたが', '補足すると', 'ちなみに', 'そうそう', 'あ、そうだ', '思い出した',
    'ごめん、忘れてた', '先ほども言いましたが', '繰り返しになりますが'
]

# Расширенные списки конечных фраз
END_PHRASES = [
    'です', 'ですね', 'ですよ', 'ですわ', 'なのです', 'かもしれません', 'でしょう', 'だろう',
    'かもね', 'に違いない', 'に決まってる', 'かもしれない', 'でしょうね', 'だと思う', 'かな',
    'なんだよね', 'ってこと', 'わけ', 'はず', 'べき', 'つもり', '予定', 'みたい', 'そう', 'らしい',
    'ようだ', 'みたいだ', '感じ', '気がする', 'と言われている', 'とされている', 'と考えられる',
    'と言える', 'と言っても過言ではない', 'と言わざるを得ない', 'に他ならない', 'にすぎない',
    'に越したことはない', 'に限る', 'かもしれないし、そうでないかもしれない', 'かどうかは分からない',
    'かも、いや、違うか', 'かもしれないけど、自信はない', 'って本当かな', 'って思う今日この頃',
    'って感じがするんだよね', 'って言う人もいる', 'ってところかな', 'ってわけさ', 'ってことだよ',
    'ってことになるね', 'ってことらしい', 'ってのが一般的な見方', 'って言ってもいいかも',
    'って思わない？', 'って気がしてならない', 'って言いたいところだけど', 'ってのが本音',
    'って言うのが適切かな', 'って感じです', 'ってことです', 'ってわけです', 'ってことになります',
    'ってことでしょう', 'ってことでいいですか', 'ってことでよろしくお願いします',
    'ってことで今日はここまで', 'ってことで終わります', 'ってことで失礼します'
]

# Иероглифы для случайной вставки
KANJI_WORDS = {
    '猫': 'ねこ', '犬': 'いぬ', '愛': 'あい', '夢': 'ゆめ', '空': 'そら',
    '桜': 'さくら', '月': 'つき', '星': 'ほし', '花': 'はな', '本': 'ほん',
    '友': 'とも', '力': 'ちから', '水': 'みず', '火': 'ひ', '風': 'かぜ'
}

# Кавайные аниме-смайлики
KAWAII_EMOJIS = [
    ' (´∀｀) ', ' (￣ω￣) ', ' (◕‿◕) ', ' (⁄ ⁄>⁄ ▽⁄<⁄ ⁄) ', ' (✿◠‿◠) ',
    ' (◡‿◡✿) ', ' (◕‿-) ', ' (=^･ｪ･^=) ', ' (^・ω・^ ) ', ' (●´ω｀●) ',
    ' ヾ(≧▽≦*)o ', ' o((>ω< ))o ', ' (｡･ω･｡) ', ' (・ω<) ', ' (づ｡◕‿‿◕｡)づ ',
    ' (ﾉ◕ヮ◕)ﾉ*:･ﾟ✧ ', ' ✧ﾟ･: *ヽ(◕ヮ◕ヽ) ', ' (ﾉ´ヮ`)ﾉ*: ･ﾟ ', ' (●´□`)♡ ',
    ' (´｡• ω •｡`) ', ' (●´□`)σ ', ' (っ◕‿◕)っ ', ' (づ￣ ³￣)づ ', ' (ﾉ◕ヮ◕)ﾉ*:･ﾟ✧ ',
    ' (ﾉ>ω<)ﾉ :｡･:*:･ﾟ’★,｡･:*:♪･ﾟ’☆ ', ' (●´ω｀●)ゞ ', ' (ﾉ◕ヮ◕)ﾉ*:･ﾟ✧ ', ' ✧･ﾟ: *✧･ﾟ:* ',
    ' (●´艸`) ', ' (✪‿✪)ノ ', ' (⁄ ⁄>⁄ ▽⁄<⁄ ⁄) ', ' (◕‿◕✿) ', ' (◕‿-) ',
    ' (=^-ω-^=) ', ' (^・ω・^ ) ', ' (●´ω｀●) ', ' ヾ(≧▽≦*)o ', ' o((>ω< ))o ',
    ' (｡･ω･｡) ', ' (・ω<) ', ' (づ｡◕‿‿◕｡)づ ', ' (ﾉ◕ヮ◕)ﾉ*:･ﾟ✧ ', ' ✧ﾟ･: *ヽ(◕ヮ◕ヽ) ',
    ' (ﾉ´ヮ`)ﾉ*: ･ﾟ ', ' (●´□`)♡ ', ' (´｡• ω •｡`) ', ' (●´□`)σ ', ' (っ◕‿◕)っ ',
    ' (づ￣ ³￣)づ ', ' (ﾉ◕ヮ◕)ﾉ*:･ﾟ✧ ', ' (ﾉ>ω<)ﾉ :｡･:*:･ﾟ’★,｡･:*:♪･ﾟ’☆ ', ' (●´ω｀●)ゞ ',
    ' ^_^', ' ^o^', ' >_<', ' T_T', ' ;_;', ' :3', ' :D', ' :P', ' :O', ' :*', ' <3',
    ' (^_^) ', ' (^o^) ', ' (>_<) ', ' (T_T) ', ' (;_;) ', ' :3 ', ' :D ', ' :P ', ' :O ', ' :* ', ' <3 ',
    ' (｡>﹏<｡) ', ' (¬_¬) ', ' (⌒_⌒;) ', ' (＾▽＾) ', ' (￣ヘ￣) ', ' (╯°□°）╯︵ ┻━┻ ', ' ヽ(´▽`)/ ',
    ' ¯\_(ツ)_/¯ ', ' ( ͡° ͜ʖ ͡°) ', ' (づ￣ ³￣)づ ', ' (っ˘ω˘ς ) ', ' (´･ω･`) ', ' (＾ω＾) ',
    ' (；一_一) ', ' (´･_･`) ', ' (⊙_◎) ', ' (・_・;) ', ' (◐‿◑)﻿ ', ' (◑‿◐) ', ' (◕‿◕) ',
    ' (◠‿◠) ', ' (◠﹏◠) ', ' (✖﹏✖) ', ' (◡﹏◡) ', ' (◕﹏◕) ', ' (◕‿◕) ', ' (◠‿◠✿) ',
    ' (◡‿◡✿) ', ' (◕‿◕✿) ', ' (◕‿◕)♡ ', ' (◕‿◕✿)♡ ', ' (◕‿◕)ノ♡ ', ' (◕‿◕✿)ノ♡ ',
    ' (っ´▽｀)っ ', ' (づ｡◕‿‿◕｡)づ ', ' (っ˘ڡ˘ς) ', ' (っ˘ω˘ς) ', ' (っ˘з˘ς) ',
    ' (っ˘з(˘⌣˘ ) ', ' (っˆڡˆς) ', ' (っˆڡˆς)っ ', ' (っˆڡˆς) ', ' (っˆڡˆς)っ ',
    ' (っ´∀｀)っ ', ' (っ´ω｀)っ ', ' (っ´▽｀)っ ', ' (っ´∀｀)ﾉ ', ' (っ´ω｀)ﾉ ',
    ' (っ´▽｀)ﾉ ', ' (っ・∀・)っ ', ' (っ・ω・)っ ', ' (っ・▽・)っ ', ' (っ・∀・)ﾉ ',
    ' (っ・ω・)ﾉ ', ' (っ・▽・)ﾉ ', ' (っ=∀=)っ ', ' (っ=ω=)っ ', ' (っ=▽=)っ ',
    ' (っ=∀=)ﾉ ', ' (っ=ω=)ﾉ ', ' (っ=▽=)ﾉ ', ' (っ´∀｀) ', ' (っ´ω｀) ',
    ' (っ´▽｀) ', ' (っ・∀・) ', ' (っ・ω・) ', ' (っ・▽・) ', ' (っ=∀=) ',
    ' (っ=ω=) ', ' (っ=▽=) ', ' (っ´∀｀) ', ' (っ´ω｀) ', ' (っ´▽｀) ',
    ' (っ・∀・) ', ' (っ・ω・) ', ' (っ・▽・) ', ' (っ=∀=) ', ' (っ=ω=) ',
    ' (っ=▽=) ', ' (っ´∀｀) ', ' (っ´ω｀) ', ' (っ´▽｀) ', ' (っ・∀・) ',
    ' (っ・ω・) ', ' (っ・▽・) ', ' (っ=∀=) ', ' (っ=ω=) ', ' (っ=▽=) ',
    ' (っ´∀｀) ', ' (っ´ω｀) ', ' (っ´▽｀) ', ' (っ・∀・) ', ' (っ・ω・) ',
    ' (っ・▽・) ', ' (っ=∀=) ', ' (っ=ω=) ', ' (っ=▽=) ', ' (っ´∀｀) ',
    ' (っ´ω｀) ', ' (っ´▽｀) ', ' (っ・∀・) ', ' (っ・ω・) ', ' (っ・▽・) ',
    ' (っ=∀=) ', ' (っ=ω=) ', ' (っ=▽=) ', ' (っ´∀｀) ', ' (っ´ω｀) ',
    ' (っ´▽｀) ', ' (っ・∀・) ', ' (っ・ω・) ', ' (っ・▽・) ', ' (っ=∀=) ',
    ' (っ=ω=) ', ' (っ=▽=) '
]

def convert_number(num_str):
    """Улучшенная конвертация чисел в японские иероглифы"""
    try:
        num = int(num_str)
        if num == 0:
            return NUMERALS[0]
        
        result = []
        units = [100000000, 10000, 1000, 100, 10, 1]
        
        for unit in units:
            if num < unit:
                continue
                
            count = num // unit
            num %= unit
            
            if count > 1 or unit == 1:
                if count >= 10:
                    result.append(convert_number(str(count)))
                else:
                    result.append(NUMERALS[count])
                    
            if unit > 1:
                result.append(NUMERALS[unit])
                
        return ''.join(result)
    except:
        return num_str

def transliterate_word(word, kana_map):
    """Улучшенная транслитерация слов с полной обработкой фонетики"""
    # Специальные последовательности
    word = re.sub(r'ться$', 'тсу', word)
    word = re.sub(r'тся$', 'тса', word)
    
    # Обработка двойных согласных
    word = re.sub(r'(.)\1', lambda m: 'っ' + m.group(1) if kana_map is HIRAGANA_MAP else 'ッ' + m.group(1), word)
    
    # Обработка мягкого знака
    word = re.sub(r'([бвгджзйклмнпрстфхцчшщ])ь([ауоыэеёюяи])', 
                 lambda m: m.group(1) + {
                     'а': 'я', 'у': 'ю', 'о': 'ё', 
                     'э': 'е', 'е': 'е', 'ы': 'и',
                     'ё': 'ё', 'ю': 'ю', 'я': 'я', 'и': 'и'
                 }[m.group(2)], word)
    
    # Основная транслитерация
    result = []
    while word:
        found = False
        # Поиск самого длинного совпадения (3 символа)
        for length in range(3, 0, -1):
            if length > len(word):
                continue
                
            syllable = word[:length]
            if syllable in kana_map:
                result.append(kana_map[syllable])
                word = word[length:]
                found = True
                break
                
        if not found:
            # Обработка одиночных согласных в конце слова
            if word in kana_map:
                result.append(kana_map[word])
                word = ''
            else:
                result.append(word[0])
                word = word[1:]
    
    return ''.join(result)

def to_kana(text, kana_map):
    """Универсальная конвертация текста в кану"""
    # Разделение на слова и символы
    tokens = re.findall(r'\w+|[^\w]', text.lower())
    result = []
    
    for token in tokens:
        if not token.isalpha():
            result.append(token)
            continue
            
        # Обработка чисел отдельно
        if token.isdigit():
            result.append(convert_number(token))
            continue
            
        result.append(transliterate_word(token, kana_map))
        
    return ''.join(result)


def anime_transform(text):
    """Основная функция преобразования в аниме-стиль со смайликами"""
    if not text.strip():
        return text
        
    # Случайный выбор каны
    kana_map = random.choice([HIRAGANA_MAP, KATAKANA_MAP])
    transformed = to_kana(text, kana_map)
    
    # Добавление японских фраз
    words = transformed.split()
    if words:
        # Начальная фраза (40% вероятность)
        if random.random() < 0.4:
            words.insert(0, random.choice(START_PHRASES))
            
        # Конечная фраза (50% вероятность)
        if random.random() < 0.5:
            words.append(random.choice(END_PHRASES))
            
        # Добавление частиц и междометий
        for i in range(len(words)):
            # Частицы (20% вероятность)
            if random.random() < 0.2:
                words[i] += random.choice(PARTICLES)
                
            # Ня-междометия (15% вероятность)
            if random.random() < 0.15:
                words[i] += random.choice(NYA_INTERJECTIONS)
                
            # Иероглифы (10% вероятность)
            if random.random() < 0.1 and KANJI_WORDS:
                kanji, reading = random.choice(list(KANJI_WORDS.items()))
                words.insert(i + 1, f"{kanji}({reading})")
                i += 1  # Пропуск добавленного слова
                
        # Добавление смайликов
        i = 0
        while i < len(words):
            # 7% вероятность вставить смайлик после текущего слова
            if random.random() < 0.07:
                words.insert(i + 1, random.choice(KAWAII_EMOJIS))
                i += 1  # Пропускаем добавленный смайлик
            i += 1
        
        # 40% вероятность добавить смайлик в конец
        if random.random() < 0.4:
            words.append(random.choice(KAWAII_EMOJIS))
            
    return ' '.join(words)
